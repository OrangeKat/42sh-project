#!/bin/sh

REF_OUT=".refstd.out"
TEST_OUT=".teststd.out"
REF_ERR=".refstd.err"
TEST_ERR=".teststd.err"
REF="bash --posix"
TEST="./../src/42sh"

COMMAND='echo +Loremipsumdolorsitamet,consecteturadipiscingelit.Aliquamconsequatmassasedurnavenenatisbibendum.Praesentavariusenim,necvehiculanulla.Utatlectusaliquam,consecteturmagnased,suscipitipsum.Maurisnecmaurisex.Utsednullasuscipit,ultricieserossed,laciniaurna.Maecenassagittis,metusnonrhoncusplacerat,nisirisusinterdummi,egetviverraurnaeratsedvelit.Utpellentesquenequeex.Nullaullamcorpervelpurusvelsagittis.Vivamusatconsequatsem.Inlaciniasednequequisrhoncus.Classaptenttacitisociosquadlitoratorquentperconubianostra,perinceptoshimenaeos.Nuncfeugiatarcununc,utefficiturauguevehiculased.Morbisodales,urnasitametlaoreetimperdiet,justodiamconsequatmauris,necsuscipitenimtortorvitaesapien.Quisqueexmauris,tempusnecdolorquis,egestasornareerat.Donecvitaeultriceseros.Donecacloremposuere,scelerisqueestid,laoreetligula.Inimperdietjustosedvehiculadignissim.Nuncutligulaeudolorbibendumconsequatineutortor.Integerornaresuscipitnuncvelullamcorper.Vestibulumdapibusnisldapibusscelerisqueconvallis.Nullamfeugiatliberononjustoornare,atvenenatislectusmollis.Maecenasefficitureniminurnaconguesodales.Nullamporttitoruterosasagittis.Fuscenonorcivulputate,vulputatenequeiaculis,vestibulumodio.Donecscelerisque,tellussitametpulvinarpretium,erattelluscursusvelit,utsemperduieratveljusto.Inaterosatarcuaccumsanaliquetsitametuturna.Donectellusante,mollissedantetincidunt,sempervehiculaest.Utcondimentum,nisieuvestibulumullamcorper,enimtortormollisfelis,avulputateenimdiamvitaetortor.Vivamuseumiacligulacondimentumaliquet.Utegethendreritarcu.Vestibulumindolorpellentesque,tinciduntmagnaat,bibendumdolor.Insagittis,justoetfringilladapibus,nislurnalaciniaorci,quismalesuadaliberolectusindui.Aliquamvehiculaliberoinplaceratsemper.Etiamrhoncus,duietelementumcursus,tellusnibhpellentesquenunc,intristiquenibhsapienneclectus.Donecpulvinaraliquamconvallis.Orcivariusnatoquepenatibusetmagnisdisparturientmontes,nasceturridiculusmus.Namexdui,consequatidfacilisissitamet,temporeutellus.Inhachabitasseplateadictumst.Donecveleleifendfelis.Inconsecteturblanditmalesuada.Suspendisseegetsagittisurna.Vestibulumsollicitudinaccumsanligula,nonbibendumdiamcommodoquis.Sedegetinterdumnisi,sitametvolutpatleo.Quisqueidporttitorsem.Proinidlacusnectortorvolutpatultriciesutideros.Etiamaliquetnisiutnequeblanditdapibus.Sedfaucibusmollisluctus.Innibhmassa,condimentumvitaenisiquis,venenatisfaucibusjusto.Duisfaucibusexodio,necultricieseroslaciniaquis.Etiamafermentumtellus.Quisquemalesuadafelissedsapienporttitorluctus.Aliquameratvolutpat.Morbiporttitornislidexgravidaeuismod.Maecenaspharetraerosnondiamtinciduntaliquamateudolor.Utiaculisvehiculanisi,idiaculisarculuctusvitae.Aliquameratvolutpat.Namidtortoreuarcuportaaccumsanconvallisvelelit.Proinenimarcu,sagittisnecenimin,viverraiaculisdiam.Quisquemaximusconsequateuismod.Ututantequisturpisfaucibuselementumnonneclacus.Sedidelitarcu.Morbinullaligula,blanditaeleifendvel,volutpatnonquam.Quisqueelementumornarenulla,condimentumcommodoleovulputatesitamet.Duistortordui,consecteturvitaesapiennec,semperdignissimorci.Orcivariusnatoquepenatibusetmagnisdisparturientmontes,nasceturridiculusmus.Vivamusaccumsanelitsem,eudapibustellusconguevel.Suspendissealiquamantenecmassapharetravenenatis.Sedrhoncussollicitudinelementum.Maecenasegestas,nibhidmattispharetra,liberoestpulvinarerat,nontinciduntenimodiosollicitudinlacus.Maecenasfinibuslaoreetorciquisposuere.Suspendisseornaretempusaugue,velposueremassaconvalliseget.Craspellentesquenibhipsum,etdapibusnequesempersed.Orcivariusnatoquepenatibusetmagnisdisparturientmontes,nasceturridiculusmus.Curabiturrhoncusexatesttempor,velaliquetelittristique.Fusceintellusegetmagnafermentummollis.Proinegetconguemi.Quisquenonvelitdolor.Vivamuseratquam,rhoncusvitaeloremac,laciniamolestiemassa.Incongueconsecteturmassa,etiaculisenim.Aeneanaccumsanmauristellus,etcommodoodiovulputateeu.Fuscedignissimornarealiquet.Praesentlobortisegetloremvelvehicula.Curabiturvehiculaenimquiseratvestibulum,vitaecursusligulalaoreet.Pellentesquelectusmauris,aliquameumagnanon,maximusplaceratmauris.Donecfacilisiseratorci,eurhoncusrisusvulputatelacinia.Sedtinciduntipsumipsum,nonplaceratnislscelerisqueid.Crassodalesnibhvelsapiencondimentumlobortis.Phaselluseuantetortor.Aliquamatelitmi.Maecenastemporaccumsansapien,amalesuadaerosfaucibusnon.Etiamauctor,lacuseusit.Loremipsumdolorsitamet,consecteturadipiscingelit.Aliquamconsequatmassasedurnavenenatisbibendum.Praesentavariusenim,necvehiculanulla.Utatlectusaliquam,consecteturmagnased,suscipitipsum.Maurisnecmaurisex.Utsednullasuscipit,ultricieserossed,laciniaurna.Maecenassagittis,metusnonrhoncusplacerat,nisirisusinterdummi,egetviverraurnaeratsedvelit.Utpellentesquenequeex.Nullaullamcorpervelpurusvelsagittis.Vivamusatconsequatsem.Inlaciniasednequequisrhoncus.Classaptenttacitisociosquadlitoratorquentperconubianostra,perinceptoshimenaeos.Nuncfeugiatarcununc,utefficiturauguevehiculased.Morbisodales,urnasitametlaoreetimperdiet,justodiamconsequatmauris,necsuscipitenimtortorvitaesapien.Quisqueexmauris,tempusnecdolorquis,egestasornareerat.Donecvitaeultriceseros.Donecacloremposuere,scelerisqueestid,laoreetligula.Inimperdietjustosedvehiculadignissim.Nuncutligulaeudolorbibendumconsequatineutortor.Integerornaresuscipitnuncvelullamcorper.Vestibulumdapibusnisldapibusscelerisqueconvallis.Nullamfeugiatliberononjustoornare,atvenenatislectusmollis.Maecenasefficitureniminurnaconguesodales.Nullamporttitoruterosasagittis.Fuscenonorcivulputate,vulputatenequeiaculis,vestibulumodio.Donecscelerisque,tellussitametpulvinarpretium,erattelluscursusvelit,utsemperduieratveljusto.Inaterosatarcuaccumsanaliquetsitametuturna.Donectellusante,mollissedantetincidunt,sempervehiculaest.Utcondimentum,nisieuvestibulumullamcorper,enimtortormollisfelis,avulputateenimdiamvitaetortor.Vivamuseumiacligulacondimentumaliquet.Utegethendreritarcu.Vestibulumindolorpellentesque,tinciduntmagnaat,bibendumdolor.Insagittis,justoetfringilladapibus,nislurnalaciniaorci,quismalesuadaliberolectusindui.Aliquamvehiculaliberoinplaceratsemper.Etiamrhoncus,duietelementumcursus,tellusnibhpellentesquenunc,intristiquenibhsapienneclectus.Donecpulvinaraliquamconvallis.Orcivariusnatoquepenatibusetmagnisdisparturientmontes,nasceturridiculusmus.Namexdui,consequatidfacilisissitamet,temporeutellus.Inhachabitasseplateadictumst.Donecveleleifendfelis.Inconsecteturblanditmalesuada.Suspendisseegetsagittisurna.Vestibulumsollicitudinaccumsanligula,nonbibendumdiamcommodoquis.Sedegetinterdumnisi,sitametvolutpatleo.Quisqueidporttitorsem.Proinidlacusnectortorvolutpatultriciesutideros.Etiamaliquetnisiutnequeblanditdapibus.Sedfaucibusmollisluctus.Innibhmassa,condimentumvitaenisiquis,venenatisfaucibusjusto.Duisfaucibusexodio,necultricieseroslaciniaquis.Etiamafermentumtellus.Quisquemalesuadafelissedsapienporttitorluctus.Aliquameratvolutpat.Morbiporttitornislidexgravidaeuismod.Maecenaspharetraerosnondiamtinciduntaliquamateudolor.Utiaculisvehiculanisi,idiaculisarculuctusvitae.Aliquameratvolutpat.Namidtortoreuarcuportaaccumsanconvallisvelelit.Proinenimarcu,sagittisnecenimin,viverraiaculisdiam.Quisquemaximusconsequateuismod.Ututantequisturpisfaucibuselementumnonneclacus.Sedidelitarcu.Morbinullaligula,blanditaeleifendvel,volutpatnonquam.Quisqueelementumornarenulla,condimentumcommodoleovulputatesitamet.Duistortordui,consecteturvitaesapiennec,semperdignissimorci.Orcivariusnatoquepenatibusetmagnisdisparturientmontes,nasceturridiculusmus.Vivamusaccumsanelitsem,eudapibustellusconguevel.Suspendissealiquamantenecmassapharetravenenatis.Sedrhoncussollicitudinelementum.Maecenasegestas,nibhidmattispharetra,liberoestpulvinarerat,nontinciduntenimodiosollicitudinlacus.Maecenasfinibuslaoreetorciquisposuere.Suspendisseornaretempusaugue,velposueremassaconvalliseget.Craspellentesquenibhipsum,etdapibusnequesempersed.Orcivariusnatoquepenatibusetmagnisdisparturientmontes,nasceturridiculusmus.Curabiturrhoncusexatesttempor,velaliquetelittristique.Fusceintellusegetmagnafermentummollis.Proinegetconguemi.Quisquenonvelitdolor.Vivamuseratquam,rhoncusvitaeloremac,laciniamolestiemassa.Incongueconsecteturmassa,etiaculisenim.Aeneanaccumsanmauristellus,etcommodoodiovulputateeu.Fuscedignissimornarealiquet.Praesentlobortisegetloremvelvehicula.Curabiturvehiculaenimquiseratvestibulum,vitaecursusligulalaoreet.Pellentesquelectusmauris,aliquameumagnanon,maximusplaceratmauris.Donecfacilisiseratorci,eurhoncusrisusvulputatelacinia.Sedtinciduntipsumipsum,nonplaceratnislscelerisqueid.Crassodalesnibhvelsapiencondimentumlobortis.Phaselluseuantetortor.Aliquamatelitmi.Maecenastemporaccumsansapien,amalesuadaerosfaucibusnon.Etiamauctor,lacuseusit.'
echo $COMMAND >in

cat in | $REF >"$REF_OUT" 2>"$REF_ERR"
REF_CODE= $?
cat in | $TEST >"$TEST_OUT" 2>"$TEST_ERR"
TEST_CODE= $?
diff "$REF_OUT" "$TEST_OUT"
DIFF_CODE=$?

if [ $REF_CODE -ne $TEST_CODE ]; then
	echo "wrong return code"
fi

if [ $DIFF_CODE -ne 0 ]; then
	echo "wrong stdout"
fi

diff "$REF_ERR" "$TEST_ERR"
ERR_CODE=$?

if [ $ERR_CODE -ne 0 ]; then
	echo "wrong stderr"
fi

rm $REF_OUT
rm $TEST_OUT
rm $REF_ERR
rm $TEST_ERR
rm in

exit $DIFF_CODE && $ERR_CODE && [ $REF_CODE -eq $TEST_CODE]
